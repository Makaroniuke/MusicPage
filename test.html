<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dual Wave Player</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

  <style>
    #knob, #knob2 {

      width: 200px;
      height: 10px;
      background: #000000;
      outline: none;
      opacity: 0.7;
      -webkit-transition: .2s;
      transition: opacity .2s;
  }
  
  #knob::-webkit-slider-thumb,  #knob2::-webkit-slider-thumb {

      appearance: none;
      width: 20px;
      height: 20px;
      background: #4CAF50;
      cursor: pointer;
  }
  
  #knob::-moz-range-thumb, #knob2::-moz-range-thumb {
      width: 20px;
      height: 20px;
      background: #4CAF50;
      cursor: pointer;
  }
  
      </style>
  </style>
  </head>
<body>
  <button id="play-btn">Play</button>

  <label class="switch">
    <input id="change-wave-btn" type="checkbox" checked>
    <span class="slider round"></span>
  </label>
 
  <button onclick="sineWave()">Play Sine Wave</button>
  <button onclick="playSquareWave()">Play Square Wave</button>

    
<style>
  .row{
    border: 2px solid grey;
    background-color: #d3d3d3;
    padding: 30px;
  }

  .correct {
    border:2px solid green;
  }

  .incorrect {
    border:2px solid red;
    }
</style>

  <div class="container">
    <br/>
    <br/>
    <br/>
    <button id="start" >Start</button>
    <button id="generateWaves">Listen generated sound</button>
    <div class="row">
      <div class="col">
        <div>Oscillator 1</div>
        <select class="form-select" name="wave" id="waves">
          <option value="square">square</option>
          <option value="sine">sine</option>
          <option value="saw">saw</option>
        </select>
        <div id="knob-value">0.40</div>
        <input type="range" id="knob" min="0" max="1" step="0.2" value="0.4">
      </div>
      <div class="col">
        <div>Oscillator 2</div>
        <select class="form-select" name="wave" id="waves2">
          <option value="square">square</option>
          <option value="sine">sine</option>
          <option value="saw">saw</option>
        </select>
        <div id="knob-value2">0.40</div>
        <input type="range" id="knob2" min="0" max="1" step="0.2" value="0.4">
      </div>
      <div class="col">
        <select name="wave" id="filter">
          <option data-image-="" value="bypass">          
            bypass</option>
          <option value="lowpass">lowpass</option>
          <option value="highpass">highpass</option>
        </select>
        <div id="knob-value3">100</div>
        <input type="range" id="knob3" min="100" max="10000" step="4000" value="0">
      </div>
      <div class="col">
        <button onclick="playWave()">Play</button>
      </div>
    </div>
<div class="row">
  <div class="">Envelope</div>
  <div class="col-1">
    <div id="knob-value4">0</div>
    <input type="range"  orient="vertical" id="knob4" min="0" max="2" step="0.5" value="0">
    <div>A</div>
  </div>
  <div class="col-1">
    <input type="range"  orient="vertical" id="knob3" min="0" max="2" step="0.5" value="0">
    <div>D</div>
    </div>
  <div class="col-1">
    <input type="range"  orient="vertical" id="knob3" min="0" max="2" step="0.5" value="0">
    <div>S</div>
  </div>
  <div class="col-1">
    <input type="range"  orient="vertical" id="knob3" min="0" max="2" step="0.5" value="0">
    <div>R</div>
  </div>

  <button id="checkAnswer">Check</button>

</div>

<label for="temp">Choose a comfortable temperature:</label><br />
<input type="range" id="temp" orient="vertical" name="temp" list="markers" />

<datalist id="markers">
  <option value="0">0</option>
  <option value="25">25</option>
  <option value="50">50</option>
  <option value="75">75</option>
  <option value="100">100</option>
</datalist>

<style>
  body{
  display: flex;
  justify-content: center;
  align-items: center;
  }
  .slider::before{
  background: linear-gradient(0deg, #525252 0%, #373737 100%);
  width: 10em;
  height: 10em;
  border-radius: 50%;
  box-shadow: 0px -20px 20px #757575,
  0px 20px 35px #111,
  inset 0px 5px 6px #979797,
  inset 0px -5px 6px #242424;
}

.slider::before .knob{
  width: 10em;
  height: 10em;
  position: relative;
}

.knob::before, .knob::after, .slider::before{
  content: '';
  position: absolute;
  border-radius: 50%;
}

.knob::before{
  top: 15px;
  left: 50%;
  transform: translateX(-50%);
  width: 10px;
  height: 10px;
  background: #fff;
  box-shadow: 0px 0px 10px #349beb;
}

.knob::after{
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 130%;
  height:130%;
  box-shadow: 0px 0px 10px #349beb,
  inset 0px 0px 10px #349beb;

}
</style>

<div class="slider">
  <div class="knob">

  </div>
</div>

  </div>

  

  <script>
    const knob = document.getElementById("knob");
    const knob2 = document.getElementById("knob2");
    const knob3 = document.getElementById("knob3");
    const knob4 = document.getElementById("knob4");
    const knobValue = document.getElementById("knob-value");
    const knobValue2 = document.getElementById("knob-value2");
    const knobValue3 = document.getElementById("knob-value3");
    const knobValue4 = document.getElementById("knob-value4");

    Math.floor(Math.random() * 11);

    const oscc1 = document.getElementById("waves")
    const oscc2 = document.getElementById("waves2")

    
    
    // Display initial value
    knobValue.textContent = knob.value;
    knobValue2.textContent = knob2.value;
    knobValue3.textContent = knob3.value;
    knobValue4.textContent = knob4.value;
    
    // Update value as knob is adjusted
    knob.addEventListener("input", function() {
        const value = knob.value;
        knobValue.textContent = value;
    });

    knob2.addEventListener("input", function() {
      const value = knob2.value;
      knobValue2.textContent = value;
    });

    knob3.addEventListener("input", function() {
      const value = knob3.value;
      knobValue3.textContent = value;
    });

    knob4.addEventListener("input", function() {
      const value = knob4.value;
      knobValue4.textContent = value;
    });


    

    const waves = ['sine', 'saw', 'square']
    const filters = ['bypass', 'lowpass', 'highpass']

    function generateRandomNumber() {
      // Sugeneruoti atsitiktinį skaičių nuo -1 iki 1
      const randomNumber = Math.random() * 2;
      // Apskritinti skaičių iki 1 decimalo taško
      const roundedNumber = Math.round(randomNumber * 10) / 10;       
      // Paskaičiuoti žingsnio dydį (0.2) kartojant iš apvalinto skaičiaus
      const stepSize = 0.1;
      const steppedNumber = Math.round(roundedNumber / stepSize) * stepSize;
      // Suapvalinti iki dviejų skaičių po kablelio ir konvertuoti į string formatą
      const roundedSteppedNumber = steppedNumber.toFixed(2);
      // Konvertuoti atgal į skaičių
      return parseFloat(roundedSteppedNumber);
  }

    function start(){
      const soundWave1 = waves[(Math.floor(Math.random() * waves.length))]
      const soundWave2 = waves[(Math.floor(Math.random() * waves.length))]
      const volume1 = generateRandomNumber()
      const volume2 = generateRandomNumber()
      const filter = 'bypass'
      const filterFrequency = 0
      const attack = 0

      return [soundWave1, soundWave2, volume1, volume2, filterType, filterFrequency, attack]
    }

    let soundWave1, soundWave2, volume1, volume2, filterType, filterFrequency, attack = 0

    document.getElementById('start').addEventListener('click', ()=>{
     [soundWave1, soundWave2, volume1, volume2, filterType, filterFrequency, attack] = start()
     console.log(soundWave1, soundWave2, volume1, volume2, filterType, filterFrequency, attack)
    })

    
    
    

    function playWave() {
      const osc1 = document.getElementById("waves").value
    const osc2 = document.getElementById("waves2").value
    const filter = document.getElementById("filter").value
      // Create AudioContext
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
      // Create an empty stereo audio buffer at the sample rate of the AudioContext
      const channels = 2; // stereo
      const sampleRate = audioContext.sampleRate;
      const duration = 1; // seconds
      const frameCount = sampleRate * duration;
   
      const attackTime = knobValue4.textContent; // Attack time in seconds
      // Create an empty audio buffer for both waves
      const audioBuffer = audioContext.createBuffer(channels, frameCount, sampleRate);
      // Fill the buffer with both sine and square waves
      for (let channel = 0; channel < channels; channel++) {
        const nowBuffering = audioBuffer.getChannelData(channel);
        console.log('loop 1')
        for (let i = 0; i < frameCount; i++) {
          const value1 = createWave(i, osc1, knobValue.textContent,attackTime, sampleRate)
          const value2 = createWave(i, osc2, knobValue2.textContent,attackTime, sampleRate)
      
          // Combine both waveforms by averaging them
          nowBuffering[i] = (value1 + value2) / 2  ;
        }
      }

      const source = audioContext.createBufferSource();
      source.buffer = audioBuffer;

      if(filter !== 'bypass'){  
        const lowpassFilter = audioContext.createBiquadFilter();
        lowpassFilter.type = filter;
        lowpassFilter.frequency.value = knobValue3.textContent
        source.connect(lowpassFilter);
        lowpassFilter.connect(audioContext.destination);
      }else{
        source.connect(audioContext.destination);
      }
      source.start();
    }


    document.getElementById('generateWaves').addEventListener('click', ()=>{
      generateWaves(soundWave1, soundWave2, volume1, volume2, filter, filterFrequency, attack)
    })

    
    function generateWaves(soundWave1, soundWave2, volume1, volume2, filter, filterFrequency, attack) {
      // Create AudioContext
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    
      // Create an empty stereo audio buffer at the sample rate of the AudioContext
      const channels = 2; // stereo
      const sampleRate = audioContext.sampleRate;
      const duration = 1; // seconds
      const frameCount = sampleRate * duration;

      // Create an empty audio buffer for both waves
      const audioBuffer = audioContext.createBuffer(channels, frameCount, sampleRate);
      // Fill the buffer with both sine and square waves
      for (let channel = 0; channel < channels; channel++) {
        const nowBuffering = audioBuffer.getChannelData(channel);
        for (let i = 0; i < frameCount; i++) {
          const value1 = createWave(i, soundWave1, volume1, attack, sampleRate)
          const value2 = createWave(i, soundWave2, volume2, attack, sampleRate)
      
          // Combine both waveforms by averaging them
          nowBuffering[i] = (value1 + value2) / 2  ;
        }
      }

      const source = audioContext.createBufferSource();
      source.buffer = audioBuffer;

      if(filter !== 'bypass'){  
        const lowpassFilter = audioContext.createBiquadFilter();
        lowpassFilter.type = filter;
        lowpassFilter.frequency.value = 0
        source.connect(lowpassFilter);
        lowpassFilter.connect(audioContext.destination);
      }else{
        source.connect(audioContext.destination);
      }


        source.start();

      
    }


    function createWave(i, osc1, volume, attack, sampleRate){
      let value1 = 0
      
      const attackSamples = attack * sampleRate; // Convert attack time to samples
      switch(osc1){
        case 'sine':{
          if (i < attackSamples) {
            value1 = (i/attackSamples) * Math.sin((i / sampleRate) * 2 * Math.PI * 440) * volume // Sine wave  
          }else{
            value1 = Math.sin((i / sampleRate) * 2 * Math.PI * 440) * volume // Sine wave  
          }
          break;     
        }   
        case 'square':{
          if (i < attackSamples) {
            value1 = (i/attackSamples) * Math.sign(Math.sin((i / sampleRate) * 2 * Math.PI * 440)) * volume // Sine wave  
          }else{
            value1 = Math.sign(Math.sin((i / sampleRate) * 2 * Math.PI * 440)) * volume // Square wave   
          }
          break;     

        }
        case 'saw':{
          const period = sampleRate / 440;
          if (i < attackSamples) {
            value1 = (i/attackSamples) * (((i % period) / period) * 2 - 1) * volume // Sine wave  
          }else{
            value1 = (((i % period) / period) * 2 - 1) * volume             
          }
          break;             
        }
      }
      return value1
    }

    function checkAnswer(){
      const osc1 = document.getElementById("waves").value
      const osc2 = document.getElementById("waves2").value
      const filter = document.getElementById("filter").value
      const a = (osc1 === soundWave1) ? oscc1.classList.toggle("correct") : oscc1.classList.toggle("incorrect")
      const b = (osc2 === soundWave2) ? oscc2.classList.toggle("correct") : oscc2.classList.toggle("incorrect")



    }

    document.getElementById('checkAnswer').addEventListener('click', ()=>{
      checkAnswer()
    })







    
    function sineWave(){
      // Create AudioContext
 const audioContext = new (window.AudioContext || window.webkitAudioContext)();

 // Create an empty stereo audio buffer at the sample rate of the AudioContext
 const channels = 2; // stereo
 const sampleRate = audioContext.sampleRate;
 const duration = 1; // seconds
 const frameCount = sampleRate * duration;
 const audioBuffer = audioContext.createBuffer(channels, frameCount, sampleRate);
// Define envelope parameters
const attackTime = 1; // Attack time in seconds
const attackSamples = attackTime * sampleRate; // Convert attack time to samples


// Fill the buffer with a sound wave with attack envelope
for (let channel = 0; channel < channels; channel++) {
 // This gives us the actual array that contains the data
 const nowBuffering = audioBuffer.getChannelData(channel);
 for (let i = 0; i < frameCount; i++) {
   // Apply attack envelope
   if (i < attackSamples) {
     // Linearly interpolate the amplitude from 0 to 1 during the attack period
     nowBuffering[i] = (i / attackSamples) * Math.sin((i / sampleRate) * 2 * Math.PI * 440); // 440Hz frequency
   } else {
     // Once attack period is over, maintain maximum amplitude
     nowBuffering[i] = Math.sin((i / sampleRate) * 2 * Math.PI * 440); // 440Hz frequency
   }
 }
}

 const lowpassFilter = audioContext.createBiquadFilter();
 lowpassFilter.type = 'lowpass';
 lowpassFilter.frequency.value = 1000

 // Create an audio source node
 const source = audioContext.createBufferSource();
 source.buffer = audioBuffer;

 source.connect(lowpassFilter);
 lowpassFilter.connect(audioContext.destination);

 // Connect the source to the output (speakers)
 //source.connect(audioContext.destination);

 // Play the sound
 source.start();
   }


  </script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
